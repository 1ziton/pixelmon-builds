/**
 * @Based on pixelmon(cipchk@qq.com) v0.1.9
 * (c) 2019 developer(developer@1ziton.com)
 * 
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@pixelmon/pikachu/pagination"),require("@pixelmon/pikachu/smart-text"),require("@pixelmon/pikachu/viewer"),require("ng-zorro-antd/badge"),require("ng-zorro-antd/button"),require("ng-zorro-antd/date-picker"),require("ng-zorro-antd/dropdown"),require("ng-zorro-antd/grid"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/input"),require("ng-zorro-antd/select"),require("ng-zorro-antd/spin"),require("ng-zorro-antd/table"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@pixelmon/pikachu/table",["exports","@angular/common","@angular/core","@angular/forms","@pixelmon/pikachu/pagination","@pixelmon/pikachu/smart-text","@pixelmon/pikachu/viewer","ng-zorro-antd/badge","ng-zorro-antd/button","ng-zorro-antd/date-picker","ng-zorro-antd/dropdown","ng-zorro-antd/grid","ng-zorro-antd/icon","ng-zorro-antd/input","ng-zorro-antd/select","ng-zorro-antd/spin","ng-zorro-antd/table","rxjs","rxjs/operators"],e):e(((n=n||self).pixelmon=n.pixelmon||{},n.pixelmon.pikachu=n.pixelmon.pikachu||{},n.pixelmon.pikachu.table={}),n.ng.common,n.ng.core,n.ng.forms,n.pixelmon.pikachu.pagination,n.pixelmon.pikachu["smart-text"],n.pixelmon.pikachu.viewer,n["ng-zorro-antd/badge"],n["ng-zorro-antd/button"],n["ng-zorro-antd/date-picker"],n["ng-zorro-antd/dropdown"],n["ng-zorro-antd/grid"],n["ng-zorro-antd/icon"],n["ng-zorro-antd/input"],n["ng-zorro-antd/select"],n["ng-zorro-antd/spin"],n["ng-zorro-antd/table"],n.rxjs,n.rxjs.operators)}(this,function(n,e,t,o,i,a,l,r,p,c,s,u,g,d,h,m,f,z,y){"use strict";var x=function(){return(x=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}).apply(this,arguments)};function C(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,i,a=t.call(n),l=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)l.push(o.value)}catch(n){i={error:n}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(i)throw i.error}}return l}function w(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(C(arguments[e]));return n}var k=function(){function n(){this.field=""}return n.prototype.ngOnInit=function(){},n.decorators=[{type:t.Component,args:[{selector:"p-tableCell",template:"<ng-content> </ng-content>"}]}],n.ctorParameters=function(){return[]},n.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},n}();var S=function(){function n(){this.field=""}return n.prototype.ngOnInit=function(){},n.decorators=[{type:t.Component,args:[{selector:"p-tableFilter",template:"<ng-content> </ng-content>"}]}],n.ctorParameters=function(){return[]},n.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},n}();var b=function(){function n(n,e){this._elementRef=n,this._renderer2=e,this.columns=[],this.data={data:[],totalSize:0},this.selections=[],this.loading=!1,this.pageSize=10,this.frontPagination=!1,this.showPagination=!0,this.fixedPagination=!1,this.showSizeChanger=!0,this.showQuickJumper=!0,this.size="middle",this.paginationSize="default",this.pageSizeOptions=[10,30,50,100],this.showCheckbox=!1,this.columnsChange=new t.EventEmitter,this.selectionsChange=new t.EventEmitter,this.load=new t.EventEmitter,this.sort=new t.EventEmitter,this.linkClick=new t.EventEmitter,this.load$=new z.Subject,this.displayData=[],this.pageIndex=1}return n.prototype.ngOnChanges=function(n){n.data&&this.sortParams&&this.sortParams.key&&this.sortParams.value&&this.onSort(this.sortParams),n.columns&&this.columns.forEach(function(n){n.showFilter&&"select"===n.filterType&&Array.isArray(n.filterOptions)&&(n.lexicon=n.lexicon?w(n.lexicon,n.filterOptions):n.filterOptions)}),n.selections&&this.updateCheckedBySelections()},n.prototype.ngOnInit=function(){var n=this;this.load$.pipe(y.debounceTime(20)).subscribe(function(){n.load.emit({page:n.pageIndex,size:n.pageSize})})},n.prototype.ngAfterViewInit=function(){this.load$.next(),this.showPagination&&this.fixedPagination&&this.toFixedPagination()},n.prototype.ngAfterContentInit=function(){var n=this;this.customCells.forEach(function(e){var t=n.columns.find(function(n){return n.field===e.field});t&&(t.customCell=e.templateRef)}),this.customFilters.forEach(function(e){var t=n.columns.find(function(n){return n.field===e.field});t&&(t.showFilter=!0,t.customFilter=e.templateRef)})},n.prototype.ngOnDestroy=function(){this.load$.unsubscribe()},n.prototype.currentPageDataChange=function(n){this.displayData=n},n.prototype.singleCheckChange=function(){this.updateSelectionsByChecked()},n.prototype.allCheckChange=function(n){this.displayData.forEach(function(e){return e.isChecked=n}),this.updateSelectionsByChecked()},n.prototype.updateSelectionsByChecked=function(){this.selections=this.displayData.filter(function(n){return n.isChecked}),this.selectionsChange.emit(this.selections)},n.prototype.updateCheckedBySelections=function(){var n=this;this.displayData.forEach(function(e){return e.isChecked=n.selections.includes(e)})},n.prototype.pageIndexChange=function(){this.load$.next()},n.prototype.pageSizeChange=function(){this.pageIndex=1,this.load$.next()},n.prototype.onSort=function(n){this.sortParams=n;var e=this.columns.find(function(e){return e.field===n.key});e&&!e.customSort&&(this.data.data.sort(function(e,t){return"descend"===n.value?t[n.key]>e[n.key]?1:-1:e[n.key]>t[n.key]?1:-1}),this.data.data=w(this.data.data)),this.sort.emit(n)},n.prototype.onRangePickerOpenChange=function(n,t){if(!1===n){var o=t.searchValue;o&&Array.isArray(o)&&2===o.length&&(t.searchValue=[e.formatDate(o[0],"yyyy-MM-dd 00:00:00","zh_CN"),e.formatDate(o[1],"yyyy-MM-dd 23:59:59","zh_CN")],t.displayValue=[e.formatDate(o[0],"yyyy-MM-dd","zh_CN"),e.formatDate(o[1],"yyyy-MM-dd","zh_CN")])}},n.prototype.onFilterConfim=function(n){n.nzDropdownMenu.setVisibleStateWhen(!1),this.columns=w(this.columns),this.columnsChange.emit(this.columns)},n.prototype.toFixedPagination=function(){var n=this;this.scroll=x({},this.scroll,{y:"0px"}),setTimeout(function(){var e=document.documentElement.clientHeight,t=n._elementRef.nativeElement.querySelector(".ant-table-body"),o=n._elementRef.nativeElement.querySelector(".p-table-pagination-container"),i=e-t.getBoundingClientRect().top-o.clientHeight+"px";n.scroll=x({},n.scroll,{y:i}),n._renderer2.setStyle(t,"height",i)})},n.prototype.onlinkClick=function(n,e){this.linkClick.emit({field:n,rowData:e})},n.decorators=[{type:t.Component,args:[{selector:"p-table",exportAs:"pTable",template:'<nz-spin [nzTip]="\'加载中...\'" [nzSpinning]="loading">\n  <nz-table\n    #nzTable\n    class="p-table"\n    [nzData]="data?.data || []"\n    [nzTitle]="titleTemplate || null"\n    [nzScroll]="scroll"\n    [nzFrontPagination]="frontPagination"\n    [nzSize]="size"\n    [nzShowPagination]="false"\n    (nzCurrentPageDataChange)="currentPageDataChange($event)"\n    [class.fixed-pagination]="fixedPagination"\n  >\n    <thead (nzSortChange)="onSort($event)" nzSingleSort>\n      <tr>\n        <th\n          *ngIf="showCheckbox"\n          nzLeft="0px"\n          nzWidth="40px"\n          nzShowCheckbox\n          [nzChecked]="selections.length > 0 && displayData.length === selections.length"\n          [nzIndeterminate]="selections.length > 0 && displayData.length !== selections.length"\n          (nzCheckedChange)="allCheckChange($event)"\n        ></th>\n        <th\n          *ngFor="let column of columns"\n          [nzLeft]="column.left"\n          [nzRight]="column.right"\n          [nzWidth]="column.width || \'120px\'"\n          [nzShowSort]="column.showSort"\n          [nzSortKey]="column.field"\n          [nzCustomFilter]="column.showFilter"\n        >\n          {{ column.title }}\n          \x3c!-- 搜索 --\x3e\n          <ng-container *ngIf="column.showFilter">\n            <i\n              nz-icon\n              nz-dropdown\n              [nzDropdownMenu]="dropdownMenu"\n              nzType="search"\n              class="ant-table-filter-icon"\n              [class.ant-table-filter-open]="dropdown.nzVisible"\n              nzTrigger="click"\n              nzPlacement="bottomRight"\n              [nzClickHide]="false"\n              nzTableFilter\n              #dropdown="nzDropdown"\n            ></i>\n            <nz-dropdown-menu #dropdownMenu="nzDropdownMenu">\n              <div class="p-table-filter-panel">\n                \x3c!-- 搜索组件 --\x3e\n                <ng-container\n                  [ngTemplateOutlet]="filterTemplate"\n                  [ngTemplateOutletContext]="{ $implicit: column, dropdown: dropdown }"\n                ></ng-container>\n                \x3c!-- 搜索确认按钮 --\x3e\n                <div nz-row nzType="flex" nzJustify="end" nzAlign="middle" class="p-table-filter-button">\n                  <button nz-button nzSize="small" nzType="primary" (click)="onFilterConfim(dropdown)">\n                    确认\n                  </button>\n                </div>\n              </div>\n            </nz-dropdown-menu>\n          </ng-container>\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <ng-container *ngFor="let row of displayData">\n        <tr>\n          <td *ngIf="showCheckbox" nzLeft="0px" nzShowCheckbox [(nzChecked)]="row.isChecked" (nzCheckedChange)="singleCheckChange()"></td>\n          <td [nzLeft]="column.left" [nzRight]="column.right" *ngFor="let column of columns">\n            \x3c!-- 单元格 --\x3e\n            <ng-container [ngTemplateOutlet]="cellTemplate" [ngTemplateOutletContext]="{ $implicit: column, row: row }"></ng-container>\n          </td>\n        </tr>\n      </ng-container>\n    </tbody>\n  </nz-table>\n\n  <div class="p-table-pagination-container">\n    <p-pagination\n      *ngIf="fixedPagination ? showPagination : showPagination && data?.totalSize"\n      [nzSize]="paginationSize"\n      [nzShowQuickJumper]="showQuickJumper"\n      [(nzPageIndex)]="pageIndex"\n      [(nzPageSize)]="pageSize"\n      [nzShowSizeChanger]="showSizeChanger"\n      [nzPageSizeOptions]="pageSizeOptions"\n      [nzTotal]="data?.totalSize || 0"\n      [nzShowTotal]="totalTemplate"\n      (nzPageIndexChange)="pageIndexChange()"\n      (nzPageSizeChange)="pageSizeChange()"\n    ></p-pagination>\n  </div>\n</nz-spin>\n\n\x3c!-- total模板 --\x3e\n<ng-template #totalTemplate let-total> 总 {{ total }} 条数据 </ng-template>\n\n\x3c!-- 搜索组件模板 --\x3e\n<ng-template #filterTemplate let-column let-dropdown="dropdown">\n  \x3c!-- 自定义搜索组件 --\x3e\n  <ng-template [ngIf]="column.customFilter" [ngIfElse]="defaultFilterTemplate">\n    <ng-container [ngTemplateOutlet]="column.customFilter" [ngTemplateOutletContext]="{ $implicit: column }"></ng-container>\n  </ng-template>\n  \x3c!-- 默认搜索组件 --\x3e\n  <ng-template #defaultFilterTemplate>\n    <ng-container [ngSwitch]="column.filterType">\n      \x3c!-- select --\x3e\n      <ng-template ngSwitchCase="select">\n        <nz-select\n          nzAllowClear\n          nzPlaceHolder="请选择"\n          [(ngModel)]="column.searchValue"\n          [nzMode]="column.filterMultiple ? \'multiple\' : \'default\'"\n          [style.width]="column.filterWidth || \'180px\'"\n        >\n          <nz-option *ngFor="let option of column.filterOptions || []" [nzValue]="option.value" [nzLabel]="option.label"></nz-option>\n        </nz-select>\n      </ng-template>\n      \x3c!-- range-picker --\x3e\n      <ng-template ngSwitchCase="rangePicker">\n        <nz-range-picker\n          nzAllowClear\n          [(ngModel)]="column.searchValue"\n          [nzStyle]="{ width: column.filterWidth || \'240px\' }"\n          (nzOnOpenChange)="onRangePickerOpenChange($event, column)"\n        ></nz-range-picker>\n      </ng-template>\n      \x3c!-- input --\x3e\n      <ng-template ngSwitchDefault>\n        <nz-input-group [nzSuffix]="suffixTemplate">\n          <input\n            #input\n            nz-input\n            placeholder="请输入"\n            [(ngModel)]="column.searchValue"\n            [style.width]="column.filterWidth || \'180px\'"\n            (keydown.enter)="onFilterConfim(dropdown)"\n          />\n        </nz-input-group>\n        <ng-template #suffixTemplate>\n          <i\n            nz-icon\n            nz-tooltip\n            class="p-table-clear-icon"\n            nzTheme="fill"\n            nzType="close-circle"\n            *ngIf="column.searchValue"\n            (click)="column.searchValue = null; input.focus()"\n          ></i>\n        </ng-template>\n      </ng-template>\n    </ng-container>\n  </ng-template>\n</ng-template>\n\n\x3c!-- 单元格模板 --\x3e\n<ng-template #cellTemplate let-column let-row="row">\n  \x3c!-- 自定义单元格 --\x3e\n  <ng-template [ngIf]="column.customCell" [ngIfElse]="defaultCellTemplate">\n    <ng-container [ngTemplateOutlet]="column.customCell" [ngTemplateOutletContext]="{ $implicit: row }"></ng-container>\n  </ng-template>\n  \x3c!-- 默认单元格 --\x3e\n  <ng-template #defaultCellTemplate>\n    <ng-container [ngSwitch]="column.type">\n      \x3c!-- link --\x3e\n      <ng-template ngSwitchCase="link">\n        <a (click)="onlinkClick(column[\'field\'], row)">\n          <smart-text [text]="row[column[\'field\']]"></smart-text>\n        </a>\n      </ng-template>\n      \x3c!-- thumbnail --\x3e\n      <ng-template ngSwitchCase="thumbnail">\n        \x3c!-- 无图片不初始化viewer --\x3e\n        <div viewer [isLazyLoad]="true" [maxShowNum]="1" *ngIf="row[column[\'field\']]?.length">\n          \x3c!-- 超过一张图片显示badge --\x3e\n          <ng-template [ngIf]="row[column[\'field\']]?.length > 1" [ngIfElse]="noBadgeTemplate">\n            <nz-badge [nzCount]="row[column[\'field\']]?.length">\n              <ng-container [ngTemplateOutlet]="noBadgeTemplate"></ng-container>\n            </nz-badge>\n          </ng-template>\n          \x3c!-- 只有一张图片不显示badge --\x3e\n          <ng-template #noBadgeTemplate>\n            <img\n              viewerImg\n              height="24px"\n              width="24px"\n              *ngFor="let url of row[column[\'field\']] || []"\n              [lazyLoadSrc]="url"\n              style="cursor: zoom-in"\n            />\n          </ng-template>\n        </div>\n      </ng-template>\n      \x3c!-- default --\x3e\n      <ng-template ngSwitchDefault>\n        <smart-text [text]="row[column[\'field\']]"></smart-text>\n      </ng-template>\n    </ng-container>\n  </ng-template>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None}]}],n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2}]},n.propDecorators={columns:[{type:t.Input}],data:[{type:t.Input}],selections:[{type:t.Input}],scroll:[{type:t.Input}],loading:[{type:t.Input}],pageSize:[{type:t.Input}],frontPagination:[{type:t.Input}],showPagination:[{type:t.Input}],fixedPagination:[{type:t.Input}],showSizeChanger:[{type:t.Input}],showQuickJumper:[{type:t.Input}],size:[{type:t.Input}],paginationSize:[{type:t.Input}],pageSizeOptions:[{type:t.Input}],showCheckbox:[{type:t.Input}],titleTemplate:[{type:t.Input}],columnsChange:[{type:t.Output}],selectionsChange:[{type:t.Output}],load:[{type:t.Output}],sort:[{type:t.Output}],linkClick:[{type:t.Output}],customCells:[{type:t.ContentChildren,args:[k]}],customFilters:[{type:t.ContentChildren,args:[S]}]},n}();var v=[b,k,S],T=[e.CommonModule,o.FormsModule,f.NzTableModule,s.NzDropDownModule,g.NzIconModule,p.NzButtonModule,d.NzInputModule,u.NzGridModule,r.NzBadgeModule,h.NzSelectModule,c.NzDatePickerModule,m.NzSpinModule,a.SmartTextModule,l.ViewerDirectiveModule,i.PaginationModule],I=function(){function n(){}return n.decorators=[{type:t.NgModule,args:[{declarations:w(v),imports:w(T),exports:w(v)}]}],n}();n.TableCellComponent=k,n.TableComponent=b,n.TableFilterComponent=S,n.TableModule=I,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=pTable.umd.min.js.map