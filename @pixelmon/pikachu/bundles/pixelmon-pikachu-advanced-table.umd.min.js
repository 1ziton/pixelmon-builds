/**
 * @Based on delon(cipchk@qq.com) v0.1.5
 * (c) 2019 giscafer(giscafer@outlook.com)
 * 
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@pixelmon/pikachu/viewer"),require("ng-zorro-antd"),require("rxjs"),require("rxjs/operators"),require("@pixelmon/pikachu/smart-text")):"function"==typeof define&&define.amd?define("@pixelmon/pikachu/advanced-table",["exports","@angular/common","@angular/core","@angular/forms","@pixelmon/pikachu/viewer","ng-zorro-antd","rxjs","rxjs/operators","@pixelmon/pikachu/smart-text"],n):n(((e=e||self).pixelmon=e.pixelmon||{},e.pixelmon.pikachu=e.pixelmon.pikachu||{},e.pixelmon.pikachu["advanced-table"]={}),e.ng.common,e.ng.core,e.ng.forms,e.pixelmon.pikachu.viewer,e.ngZorroAntd,e.rxjs,e.rxjs.operators,e.pixelmon.pikachu["smart-text"])}(this,function(e,n,t,o,i,a,l,r,c){"use strict";var s=function(){return(s=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function p(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,i,a=t.call(e),l=[];try{for(;(void 0===n||n-- >0)&&!(o=a.next()).done;)l.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(i)throw i.error}}return l}function u(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(p(arguments[n]));return e}var h=function(){function e(){this.field=""}return e.prototype.ngOnInit=function(){},e.decorators=[{type:t.Component,args:[{selector:"p-advancedCell",template:"<ng-content> </ng-content>"}]}],e.ctorParameters=function(){return[]},e.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},e}();var g=function(){function e(){this.field=""}return e.prototype.ngOnInit=function(){},e.decorators=[{type:t.Component,args:[{selector:"p-advancedFilter",template:"<ng-content> </ng-content>"}]}],e.ctorParameters=function(){return[]},e.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},e}();var d=function(){function e(e,n){this._elementRef=e,this._renderer2=n,this.columns=[],this.data={data:[],totalSize:0},this.selections=[],this.loading=!1,this.pageSize=10,this.frontPagination=!1,this.showPagination=!0,this.fixedPagination=!1,this.showSizeChanger=!0,this.size="middle",this.pageSizeOptions=[10,30,50,100],this.showCheckbox=!1,this.columnsChange=new t.EventEmitter,this.selectionsChange=new t.EventEmitter,this.load=new t.EventEmitter,this.sort=new t.EventEmitter,this.linkClick=new t.EventEmitter,this.load$=new l.Subject,this.displayData=[],this.pageIndex=1}return e.prototype.ngOnChanges=function(e){e.data&&this.sortParams&&this.sortParams.key&&this.sortParams.value&&this.onSort(this.sortParams),e.columns&&e.columns.currentValue.forEach(function(e){e.showFilter&&"select"===e.filterType&&Array.isArray(e.filterOptions)&&(e.lexicon=e.lexicon?u(e.lexicon,e.filterOptions):e.filterOptions)}),e.selections&&this.updateCheckedBySelections()},e.prototype.ngOnInit=function(){var e=this;this.load$.pipe(r.debounceTime(20)).subscribe(function(){e.selections=[],e.selectionsChange.emit(e.selections),e.load.emit({page:e.pageIndex,size:e.pageSize})})},e.prototype.ngAfterViewInit=function(){this.load$.next(),this.fixedPagination&&this.toFixedPagination()},e.prototype.ngAfterContentInit=function(){var e=this;this.customCells.forEach(function(n){var t=e.columns.find(function(e){return e.field===n.field});t&&(t.customCell=n.templateRef)}),this.customFilters.forEach(function(n){var t=e.columns.find(function(e){return e.field===n.field});t&&(t.showFilter=!0,t.customFilter=n.templateRef)})},e.prototype.ngOnDestroy=function(){this.load$.unsubscribe()},e.prototype.currentPageDataChange=function(e){this.displayData=e},e.prototype.singleCheckChange=function(){this.updateSelectionsByChecked()},e.prototype.allCheckChange=function(e){this.displayData.forEach(function(n){return n.isChecked=e}),this.updateSelectionsByChecked()},e.prototype.updateSelectionsByChecked=function(){this.selections=this.displayData.filter(function(e){return e.isChecked}),this.selectionsChange.emit(this.selections)},e.prototype.updateCheckedBySelections=function(){var e=this;this.displayData.forEach(function(n){return n.isChecked=e.selections.includes(n)})},e.prototype.pageIndexChange=function(){this.load$.next()},e.prototype.pageSizeChange=function(){this.pageIndex=1,this.load$.next()},e.prototype.onSort=function(e){this.sortParams=e;var n=this.columns.find(function(n){return n.field===e.key});n&&!n.customSort&&(this.data.data.sort(function(n,t){return"descend"===e.value?t[e.key]>n[e.key]?1:-1:n[e.key]>t[e.key]?1:-1}),this.data.data=u(this.data.data)),this.sort.emit(e)},e.prototype.onRangePickerOpenChange=function(e,t){if(!1===e){var o=t.searchValue;o&&Array.isArray(o)&&2===o.length&&(t.searchValue=[n.formatDate(o[0],"yyyy-MM-dd 00:00:00","zh_CN"),n.formatDate(o[1],"yyyy-MM-dd 23:59:59","zh_CN")],t.displayValue=[n.formatDate(o[0],"yyyy-MM-dd","zh_CN"),n.formatDate(o[1],"yyyy-MM-dd","zh_CN")])}},e.prototype.onFilterConfim=function(e){e.setVisibleStateWhen(!1),this.columns=u(this.columns),this.columnsChange.emit(this.columns)},e.prototype.toFixedPagination=function(){var e=this;this.scroll={y:"0px"},setTimeout(function(){var n=document.documentElement.clientHeight,t=e._elementRef.nativeElement.querySelector(".ant-table-body"),o=e._elementRef.nativeElement.querySelector("nz-pagination"),i=n-t.getBoundingClientRect().top-o.clientHeight-8+"px";e.scroll=s({},e.scroll,{y:i}),e._renderer2.setStyle(t,"height",i)})},e.prototype.onlinkClick=function(e,n){this.linkClick.emit({field:e,rowData:n})},e.decorators=[{type:t.Component,args:[{selector:"p-advancedTable",template:'<nz-table\n  class="advanced-table"\n  [nzData]="data?.data || []"\n  [nzLoading]="loading"\n  [nzTitle]="titleTemplate || null"\n  [nzScroll]="scroll"\n  [nzFrontPagination]="frontPagination"\n  [nzSize]="size"\n  [nzShowPagination]="showPagination"\n  [(nzPageIndex)]="pageIndex"\n  [(nzPageSize)]="pageSize"\n  [nzShowSizeChanger]="showSizeChanger"\n  [nzPageSizeOptions]="pageSizeOptions"\n  [nzTotal]="data?.totalSize || 0"\n  [nzShowTotal]="totalTemplate"\n  (nzPageIndexChange)="pageIndexChange()"\n  (nzPageSizeChange)="pageSizeChange()"\n  (nzCurrentPageDataChange)="currentPageDataChange($event)"\n  [class.fixed-pagination]="fixedPagination"\n>\n  <thead (nzSortChange)="onSort($event)" nzSingleSort>\n    <tr>\n      <th\n        *ngIf="showCheckbox"\n        nzLeft="0px"\n        nzWidth="40px"\n        nzShowCheckbox\n        [nzChecked]="selections.length > 0 && displayData.length === selections.length"\n        [nzIndeterminate]="selections.length > 0 && displayData.length !== selections.length"\n        (nzCheckedChange)="allCheckChange($event)"\n      ></th>\n      <th\n        *ngFor="let column of columns"\n        [nzLeft]="column.left"\n        [nzRight]="column.right"\n        [nzWidth]="column.width || \'120px\'"\n        [nzShowSort]="column.showSort"\n        [nzSortKey]="column.field"\n        [nzCustomFilter]="column.showFilter"\n      >\n        {{ column.title }}\n        <nz-dropdown *ngIf="column.showFilter" nzTrigger="click" nzPlacement="bottomRight" [nzClickHide]="false" nzTableFilter #dropdown>\n          <i nz-icon nzType="search" class="ant-table-filter-icon" [class.ant-table-filter-open]="dropdown.nzVisible" nz-dropdown></i>\n          <div class="advanced-table-filter-panel">\n            \x3c!-- 自定义搜索组件 --\x3e\n            <ng-template [ngIf]="column.customFilter" [ngIfElse]="defaultFilterTemplate">\n              <ng-container [ngTemplateOutlet]="column.customFilter" [ngTemplateOutletContext]="{ $implicit: column }"></ng-container>\n            </ng-template>\n            \x3c!-- 默认搜索组件 --\x3e\n            <ng-template #defaultFilterTemplate>\n              <ng-container [ngSwitch]="column.filterType">\n                \x3c!-- select --\x3e\n                <ng-template ngSwitchCase="select">\n                  <nz-select\n                    nzAllowClear\n                    nzPlaceHolder="请选择"\n                    [(ngModel)]="column.searchValue"\n                    [nzMode]="column.filterMultiple ? \'multiple\' : \'default\'"\n                    [style.width]="column.filterWidth || \'180px\'"\n                  >\n                    <nz-option\n                      *ngFor="let option of column.filterOptions || []"\n                      [nzValue]="option.value"\n                      [nzLabel]="option.label"\n                    ></nz-option>\n                  </nz-select>\n                </ng-template>\n                \x3c!-- range-picker --\x3e\n                <ng-template ngSwitchCase="rangePicker">\n                  <nz-range-picker\n                    nzAllowClear\n                    [(ngModel)]="column.searchValue"\n                    [nzStyle]="{ width: column.filterWidth || \'240px\' }"\n                    (nzOnOpenChange)="onRangePickerOpenChange($event, column)"\n                  ></nz-range-picker>\n                </ng-template>\n                \x3c!-- input --\x3e\n                <ng-template ngSwitchDefault>\n                  <nz-input-group [nzSuffix]="suffixTemplate">\n                    <input\n                      #input\n                      nz-input\n                      placeholder="请输入"\n                      [(ngModel)]="column.searchValue"\n                      [style.width]="column.filterWidth || \'180px\'"\n                      (keydown.enter)="onFilterConfim(dropdown)"\n                    />\n                  </nz-input-group>\n                  <ng-template #suffixTemplate>\n                    <i\n                      nz-icon\n                      nz-tooltip\n                      class="clear-icon"\n                      nzTheme="fill"\n                      nzType="close-circle"\n                      *ngIf="column.searchValue"\n                      (click)="column.searchValue = null; input.focus()"\n                    ></i>\n                  </ng-template>\n                </ng-template>\n              </ng-container>\n            </ng-template>\n            \x3c!-- 按钮 --\x3e\n            <div nz-row nzType="flex" nzJustify="end" nzAlign="middle" class="advanced-table-filter-button">\n              <button nz-button nzSize="small" nzType="primary" (click)="onFilterConfim(dropdown)">\n                确认\n              </button>\n            </div>\n          </div>\n        </nz-dropdown>\n      </th>\n    </tr>\n  </thead>\n  <tbody>\n    <ng-container *ngFor="let row of displayData">\n      <tr>\n        <td *ngIf="showCheckbox" nzLeft="0px" nzShowCheckbox [(nzChecked)]="row.isChecked" (nzCheckedChange)="singleCheckChange()"></td>\n        <td [nzLeft]="column.left" [nzRight]="column.right" *ngFor="let column of columns">\n          \x3c!-- 自定义单元格 --\x3e\n          <ng-template [ngIf]="column.customCell" [ngIfElse]="defaultCellTemplate">\n            <ng-container [ngTemplateOutlet]="column.customCell" [ngTemplateOutletContext]="{ $implicit: row }"></ng-container>\n          </ng-template>\n          \x3c!-- 默认单元格 --\x3e\n          <ng-template #defaultCellTemplate>\n            <ng-container [ngSwitch]="column.type">\n              \x3c!-- link --\x3e\n              <ng-template ngSwitchCase="link">\n                <a (click)="onlinkClick(column[\'field\'], row)">\n                  <smart-text [text]="row[column[\'field\']]"></smart-text>\n                </a>\n              </ng-template>\n              \x3c!-- thumbnail --\x3e\n              <ng-template ngSwitchCase="thumbnail">\n                \x3c!-- 无图片不初始化viewer --\x3e\n                <div viewer [isLazyLoad]="true" [maxShowNum]="1" *ngIf="row[column[\'field\']]?.length">\n                  \x3c!-- 超过一张图片显示badge --\x3e\n                  <ng-template [ngIf]="row[column[\'field\']]?.length > 1" [ngIfElse]="noBadgeTemplate">\n                    <nz-badge [nzCount]="row[column[\'field\']]?.length">\n                      <ng-container [ngTemplateOutlet]="noBadgeTemplate"></ng-container>\n                    </nz-badge>\n                  </ng-template>\n                  \x3c!-- 只有一张图片不显示badge --\x3e\n                  <ng-template #noBadgeTemplate>\n                    <img\n                      viewerImg\n                      height="24px"\n                      width="24px"\n                      *ngFor="let url of row[column[\'field\']] || []"\n                      [lazyLoadSrc]="url"\n                      style="cursor: zoom-in"\n                    />\n                  </ng-template>\n                </div>\n              </ng-template>\n              \x3c!-- default --\x3e\n              <ng-template ngSwitchDefault>\n                <smart-text [text]="row[column[\'field\']]"></smart-text>\n              </ng-template>\n            </ng-container>\n          </ng-template>\n        </td>\n      </tr>\n    </ng-container>\n  </tbody>\n\n  \x3c!-- total模板 --\x3e\n  <ng-template #totalTemplate let-total> 总 {{ total }} 条数据 </ng-template>\n</nz-table>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep .ant-table-scroll{position:relative}:host ::ng-deep .fixed-pagination .ant-table-placeholder{position:absolute;bottom:0;width:100%}td{word-break:break-all}.clear-icon{color:rgba(0,0,0,.25);font-size:12px;vertical-align:top;cursor:pointer;transition:color .3s}.clear-icon:hover{color:rgba(0,0,0,.45)}"]}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2}]},e.propDecorators={columns:[{type:t.Input}],data:[{type:t.Input}],selections:[{type:t.Input}],scroll:[{type:t.Input}],loading:[{type:t.Input}],pageSize:[{type:t.Input}],frontPagination:[{type:t.Input}],showPagination:[{type:t.Input}],fixedPagination:[{type:t.Input}],showSizeChanger:[{type:t.Input}],size:[{type:t.Input}],pageSizeOptions:[{type:t.Input}],showCheckbox:[{type:t.Input}],titleTemplate:[{type:t.Input}],columnsChange:[{type:t.Output}],selectionsChange:[{type:t.Output}],load:[{type:t.Output}],sort:[{type:t.Output}],linkClick:[{type:t.Output}],customCells:[{type:t.ContentChildren,args:[h]}],customFilters:[{type:t.ContentChildren,args:[g]}]},e}();var m=[d,h,g],f=[n.CommonModule,o.FormsModule,a.NgZorroAntdModule,c.SmartTextModule,i.ViewerDirectiveModule],y=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:u(m),imports:u(f),exports:u(f,m)}]}],e}();e.AdvancedTableModule=y,e.ɵa=d,e.ɵb=h,e.ɵc=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pixelmon-pikachu-advanced-table.umd.min.js.map