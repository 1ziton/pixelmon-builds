/**
 * @license ng-alain(cipchk@qq.com) v0.1.2
 * (c) 2019 giscafer(giscafer@outlook.com)
 * License: MIT
 */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@pixelmon/pikachu/viewer"),require("ng-zorro-antd"),require("rxjs"),require("rxjs/operators"),require("@pixelmon/theme"),require("ng-zorro-antd/tooltip")):"function"==typeof define&&define.amd?define("@pixelmon/pikachu/advanced-table",["exports","@angular/common","@angular/core","@angular/forms","@pixelmon/pikachu/viewer","ng-zorro-antd","rxjs","rxjs/operators","@pixelmon/theme","ng-zorro-antd/tooltip"],e):e(((n=n||self).pixelmon=n.pixelmon||{},n.pixelmon.pikachu=n.pixelmon.pikachu||{},n.pixelmon.pikachu["advanced-table"]={}),n.ng.common,n.ng.core,n.ng.forms,n.pixelmon.pikachu.viewer,n.ngZorroAntd,n.rxjs,n.rxjs.operators,n.theme,n.tooltip)}(this,function(n,e,t,o,a,i,l,r,s,c){"use strict";var p=function(){return(p=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}).apply(this,arguments)};function u(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,a,i=t.call(n),l=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)l.push(o.value)}catch(n){a={error:n}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return l}function g(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(u(arguments[e]));return n}var h=function(){function n(){this.field=""}return n.prototype.ngOnInit=function(){},n.decorators=[{type:t.Component,args:[{selector:"advanced-cell",template:"<ng-content> </ng-content>"}]}],n.ctorParameters=function(){return[]},n.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},n}(),d=function(){function n(){this.field=""}return n.prototype.ngOnInit=function(){},n.decorators=[{type:t.Component,args:[{selector:"advanced-filter",template:"<ng-content> </ng-content>"}]}],n.ctorParameters=function(){return[]},n.propDecorators={field:[{type:t.Input}],templateRef:[{type:t.ContentChild,args:[t.TemplateRef,{static:!1}]}]},n}(),m=function(){function n(n,e){this._elementRef=n,this._renderer2=e,this.columns=[],this.data={content:[],totalElements:0},this.selections=[],this.loading=!1,this.pageSize=10,this.frontPagination=!1,this.showPagination=!0,this.fixedPagination=!0,this.showSizeChanger=!0,this.size="middle",this.pageSizeOptions=[10,30,50,100],this.showCheckbox=!1,this.showTitle=!0,this.columnsChange=new t.EventEmitter,this.selectionsChange=new t.EventEmitter,this.load=new t.EventEmitter,this.sort=new t.EventEmitter,this.linkClick=new t.EventEmitter,this.load$=new l.Subject,this.displayData=[],this.pageIndex=1,this.queryParams={}}return n.prototype.ngOnChanges=function(n){n.data&&this.sortParams&&this.sortParams.key&&this.sortParams.value&&this.onSort(this.sortParams),n.columns&&n.columns.currentValue.forEach(function(n){n.showFilter&&"select"===n.filterType&&Array.isArray(n.filterOptions)&&(n.lexicon=n.lexicon?g(n.lexicon,n.filterOptions):n.filterOptions)})},n.prototype.ngOnInit=function(){var n=this;this.load$.pipe(r.debounceTime(20)).subscribe(function(){n.selections=[],n.selectionsChange.emit(n.selections),n.load.emit([{page:n.pageIndex,size:n.pageSize},n.queryParams])})},n.prototype.ngAfterViewInit=function(){this.load$.next(),this.fixedPagination&&this.toFixedPagination()},n.prototype.ngAfterContentInit=function(){var n=this;this.customCells.forEach(function(e){var t=n.columns.find(function(n){return n.field===e.field});t&&(t.customCell=e.templateRef)}),this.customFilters.forEach(function(e){var t=n.columns.find(function(n){return n.field===e.field});t&&(t.showFilter=!0,t.customFilter=e.templateRef)})},n.prototype.ngOnDestroy=function(){this.load$.unsubscribe()},n.prototype.currentPageDataChange=function(n){this.displayData=n},n.prototype.singleCheckChange=function(){this.updateSelections()},n.prototype.allCheckChange=function(n){this.displayData.forEach(function(e){return e.isChecked=n}),this.updateSelections()},n.prototype.updateSelections=function(){this.selections=this.displayData.filter(function(n){return n.isChecked}),this.selectionsChange.emit(this.selections)},n.prototype.pageIndexChange=function(){this.load$.next()},n.prototype.pageSizeChange=function(){this.pageIndex=1,this.load$.next()},n.prototype.onSort=function(n){this.sortParams=n;var e=this.columns.find(function(e){return e.field===n.key});e&&!e.customSort&&(this.data.content.sort(function(e,t){return"descend"===n.value?t[n.key]>e[n.key]?1:-1:e[n.key]>t[n.key]?1:-1}),this.data.content=g(this.data.content)),this.sort.emit(n)},n.prototype.onRangePickerOpenChange=function(n,t){if(!1===n){var o=t.searchValue;o&&Array.isArray(o)&&2===o.length&&(t.searchValue=[e.formatDate(o[0],"yyyy-MM-dd 00:00:00","zh_CN"),e.formatDate(o[1],"yyyy-MM-dd 23:59:59","zh_CN")],t.displayValue=[e.formatDate(o[0],"yyyy-MM-dd","zh_CN"),e.formatDate(o[1],"yyyy-MM-dd","zh_CN")])}},n.prototype.onFilterConfim=function(){this.columns=g(this.columns),this.columnsChange.emit(this.columns)},n.prototype.onQueryChange=function(n){this.queryParams=n,this.load$.next()},n.prototype.toFixedPagination=function(){var n=this;this.scroll={y:"0px"},setTimeout(function(){var e=document.documentElement.clientHeight,t=n._elementRef.nativeElement.querySelector(".ant-table-body"),o=n._elementRef.nativeElement.querySelector("nz-pagination"),a=e-t.getBoundingClientRect().top-o.clientHeight-8+"px";n.scroll=p({},n.scroll,{y:a}),n._renderer2.setStyle(t,"height",a)})},n.prototype.onlinkClick=function(n,e){this.linkClick.emit({field:n,rowData:e})},n.decorators=[{type:t.Component,args:[{selector:"advanced-table",template:'\x3c!-- 包裹表格+分页 --\x3e\n<nz-spin [nzSpinning]="loading">\n  <nz-table\n    [nzData]="data?.content || []"\n    [nzTitle]="showTitle ? titleTemplate || defaultTitleTemplate : null"\n    [nzScroll]="scroll"\n    [nzFrontPagination]="frontPagination"\n    [nzSize]="size"\n    [nzShowPagination]="false"\n    [(nzPageIndex)]="pageIndex"\n    [(nzPageSize)]="pageSize"\n    [nzShowSizeChanger]="showSizeChanger"\n    [nzPageSizeOptions]="pageSizeOptions"\n    [nzTotal]="data?.totalElements || 0"\n    [nzShowTotal]="totalTemplate"\n    (nzPageIndexChange)="pageIndexChange()"\n    (nzPageSizeChange)="pageSizeChange()"\n    (nzCurrentPageDataChange)="currentPageDataChange($event)"\n    [class.fixed-pagination]="fixedPagination"\n  >\n    <thead (nzSortChange)="onSort($event)" nzSingleSort>\n      <tr>\n        <th\n          *ngIf="showCheckbox"\n          nzLeft="0px"\n          nzWidth="40px"\n          nzShowCheckbox\n          [nzChecked]="selections.length > 0 && displayData.length === selections.length"\n          [nzIndeterminate]="selections.length > 0 && displayData.length !== selections.length"\n          (nzCheckedChange)="allCheckChange($event)"\n        ></th>\n        <th\n          *ngFor="let column of columns"\n          [nzLeft]="column.left"\n          [nzRight]="column.right"\n          [nzWidth]="column.width || \'120px\'"\n          [nzShowSort]="column.showSort"\n          [nzSortKey]="column.field"\n          [nzCustomFilter]="column.showFilter"\n        >\n          {{ column.title }}\n          <nz-dropdown\n            *ngIf="column.showFilter"\n            nzTrigger="click"\n            nzPlacement="bottomRight"\n            [nzClickHide]="false"\n            nzTableFilter\n            #dropdown\n          >\n            <i\n              nz-icon\n              nzType="search"\n              class="ant-table-filter-icon"\n              [class.ant-table-filter-open]="dropdown.nzVisible"\n              nz-dropdown\n            ></i>\n            <div class="padding-8">\n              \x3c!-- 自定义搜索组件 --\x3e\n              <ng-template [ngIf]="column.customFilter" [ngIfElse]="defaultFilterTemplate">\n                <ng-container\n                  [ngTemplateOutlet]="column.customFilter"\n                  [ngTemplateOutletContext]="{ $implicit: column }"\n                ></ng-container>\n              </ng-template>\n              \x3c!-- 默认搜索组件 --\x3e\n              <ng-template #defaultFilterTemplate>\n                <ng-container [ngSwitch]="column.filterType">\n                  \x3c!-- select --\x3e\n                  <ng-template ngSwitchCase="select">\n                    <nz-select\n                      nzAllowClear\n                      nzPlaceHolder="请选择"\n                      [(ngModel)]="column.searchValue"\n                      [nzMode]="filterMultiple ? \'multiple\' : \'default\'"\n                      [style.width]="column.filterWidth || \'180px\'"\n                    >\n                      <nz-option\n                        *ngFor="let option of column.filterOptions || []"\n                        [nzValue]="option.value"\n                        [nzLabel]="option.label"\n                      ></nz-option>\n                    </nz-select>\n                  </ng-template>\n                  \x3c!-- range-picker --\x3e\n                  <ng-template ngSwitchCase="rangePicker">\n                    <nz-range-picker\n                      nzAllowClear\n                      [(ngModel)]="column.searchValue"\n                      [nzStyle]="{ width: column.filterWidth || \'240px\' }"\n                      (nzOnOpenChange)="onRangePickerOpenChange($event, column)"\n                    ></nz-range-picker>\n                  </ng-template>\n                  \x3c!-- input --\x3e\n                  <ng-template ngSwitchDefault>\n                    <nz-input-group [nzSuffix]="suffixTemplate">\n                      <input\n                        #input\n                        nz-input\n                        placeholder="请输入"\n                        [(ngModel)]="column.searchValue"\n                        [style.width]="column.filterWidth || \'180px\'"\n                        (keydown.enter)="dropdown.setVisibleStateWhen(false); onFilterConfim()"\n                      />\n                    </nz-input-group>\n                    <ng-template #suffixTemplate>\n                      <i\n                        nz-icon\n                        nz-tooltip\n                        class="clear-icon"\n                        nzTheme="fill"\n                        nzType="close-circle"\n                        *ngIf="column.searchValue"\n                        (click)="column.searchValue = null; input.focus()"\n                      ></i>\n                    </ng-template>\n                  </ng-template>\n                </ng-container>\n              </ng-template>\n              \x3c!-- 按钮 --\x3e\n              <div nz-row nzType="flex" nzJustify="end" nzAlign="middle" class="margin-top-8">\n                <button\n                  nz-button\n                  nzSize="small"\n                  nzType="primary"\n                  (click)="dropdown.setVisibleStateWhen(false); onFilterConfim()"\n                >\n                  确认\n                </button>\n              </div>\n            </div>\n          </nz-dropdown>\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <ng-container *ngFor="let row of displayData">\n        <tr>\n          <td\n            *ngIf="showCheckbox"\n            nzLeft="0px"\n            nzShowCheckbox\n            [(nzChecked)]="row.isChecked"\n            (nzCheckedChange)="singleCheckChange()"\n          ></td>\n          <td [nzLeft]="column.left" [nzRight]="column.right" *ngFor="let column of columns">\n            \x3c!-- 自定义单元格 --\x3e\n            <ng-template [ngIf]="column.customCell" [ngIfElse]="defaultCellTemplate">\n              <ng-container\n                [ngTemplateOutlet]="column.customCell"\n                [ngTemplateOutletContext]="{ $implicit: row }"\n              ></ng-container>\n            </ng-template>\n            \x3c!-- 默认单元格 --\x3e\n            <ng-template #defaultCellTemplate>\n              <ng-container [ngSwitch]="column.type">\n                \x3c!-- link --\x3e\n                <ng-template ngSwitchCase="link">\n                  <a (click)="onlinkClick(column[\'field\'], row)">\n                    <smart-text [text]="row[column[\'field\']]"></smart-text>\n                  </a>\n                </ng-template>\n                \x3c!-- thumbnail --\x3e\n                <ng-template ngSwitchCase="thumbnail">\n                  \x3c!-- 无图片不初始化viewer --\x3e\n                  <div viewer [isLazyLoad]="true" [maxShowNum]="1" *ngIf="row[column[\'field\']]?.length">\n                    \x3c!-- 超过一张图片显示badge --\x3e\n                    <ng-template [ngIf]="row[column[\'field\']]?.length > 1" [ngIfElse]="noBadgeTemplate">\n                      <nz-badge [nzCount]="row[column[\'field\']]?.length">\n                        <ng-container [ngTemplateOutlet]="noBadgeTemplate"></ng-container>\n                      </nz-badge>\n                    </ng-template>\n                    \x3c!-- 只有一张图片不显示badge --\x3e\n                    <ng-template #noBadgeTemplate>\n                      <img\n                        viewerImg\n                        height="24px"\n                        width="24px"\n                        *ngFor="let url of row[column[\'field\']] || []"\n                        [lazyLoadSrc]="url"\n                        style="cursor: zoom-in"\n                      />\n                    </ng-template>\n                  </div>\n                </ng-template>\n                \x3c!-- default --\x3e\n                <ng-template ngSwitchDefault>\n                  <smart-text [text]="row[column[\'field\']]"></smart-text>\n                </ng-template>\n              </ng-container>\n            </ng-template>\n          </td>\n        </tr>\n      </ng-container>\n    </tbody>\n\n    \x3c!-- total模板 --\x3e\n    <ng-template #totalTemplate let-total> 总 {{ total }} 条数据 </ng-template>\n    \x3c!-- 默认title模板 --\x3e\n    <ng-template #defaultTitleTemplate>\n      <div class="content-header" [hidden]="selections.length">\n        <div class="content-title">列表</div>\n        <div class="content-query">\n          <query-display [(columns)]="columns" (queryChange)="onQueryChange($event)"></query-display>\n        </div>\n      </div>\n      <div class="content-header" [hidden]="!selections.length">\n        <div class="selection-box">\n          已选 <span class="color-theme">{{ selections.length }}</span> 项\n          <a *ngIf="selections.length" class="margin-left-16" (click)="allCheckChange(false)">取消</a>\n        </div>\n        \x3c!-- 绑定操作列表的ng-content --\x3e\n        <ng-content select=".operation-box"> </ng-content>\n      </div>\n    </ng-template>\n  </nz-table>\n\n  \x3c!-- 额外分页组件，不使用表格自带分页，为了满足UI的没有数据也要显示分页的需求 --\x3e\n  <nz-pagination\n    nzSize="small"\n    [(nzPageIndex)]="pageIndex"\n    [(nzPageSize)]="pageSize"\n    [nzShowSizeChanger]="showSizeChanger"\n    [nzPageSizeOptions]="pageSizeOptions"\n    [nzTotal]="data?.totalElements || 0"\n    [nzShowTotal]="totalTemplate"\n    (nzPageIndexChange)="pageIndexChange()"\n    (nzPageSizeChange)="pageSizeChange()"\n  >\n  </nz-pagination>\n</nz-spin>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:["nz-pagination{display:flex;height:48px;flex-direction:column;justify-content:center;align-items:flex-end;margin-top:2px;box-shadow:0 -2px 5px 0 rgba(194,194,194,.5)}:host ::ng-deep .ant-table-scroll{position:relative}:host ::ng-deep .fixed-pagination .ant-table-placeholder{position:absolute;width:100%;bottom:0}td{word-break:break-all}.clear-icon{color:rgba(0,0,0,.25);font-size:12px;vertical-align:top;cursor:pointer;transition:color .3s}.clear-icon:hover{color:rgba(0,0,0,.45)}"]}]}],n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2}]},n.propDecorators={columns:[{type:t.Input}],data:[{type:t.Input}],selections:[{type:t.Input}],scroll:[{type:t.Input}],loading:[{type:t.Input}],pageSize:[{type:t.Input}],frontPagination:[{type:t.Input}],showPagination:[{type:t.Input}],fixedPagination:[{type:t.Input}],showSizeChanger:[{type:t.Input}],size:[{type:t.Input}],pageSizeOptions:[{type:t.Input}],showCheckbox:[{type:t.Input}],showTitle:[{type:t.Input}],titleTemplate:[{type:t.Input}],filterMultiple:[{type:t.Input}],columnsChange:[{type:t.Output}],selectionsChange:[{type:t.Output}],load:[{type:t.Output}],sort:[{type:t.Output}],linkClick:[{type:t.Output}],customCells:[{type:t.ContentChildren,args:[h]}],customFilters:[{type:t.ContentChildren,args:[d]}]},n}(),f=function(){function n(){this.columns=[],this.lexicon=[],this.columnsChange=new t.EventEmitter,this.queryChange=new t.EventEmitter,this.close=new t.EventEmitter,this.filterRule=function(n){var e=n.searchValue;return(!n.hasOwnProperty("defaultValue")||e!==n.defaultValue)&&(![void 0,null,""].includes(e)&&!(Array.isArray(e)&&!e.length))}}return n.prototype.ngOnInit=function(){},n.prototype.ngOnChanges=function(n){n.columns&&this.updateQuery()},n.prototype.onClose=function(n){n.searchValue=n.hasOwnProperty("defaultValue")?n.defaultValue:null,this.close.emit(n),this.columns=g(this.columns),this.columnsChange.emit(this.columns)},n.prototype.updateQuery=function(){var n={};this.columns.forEach(function(e){e.showFilter&&(n[e.field]=e.searchValue)}),this.queryChange.emit(n)},n.prototype.closeTab=function(n){console.log(n)},n.decorators=[{type:t.Component,args:[{selector:"query-display",template:'<nz-tabset nzType="card">\n  <ng-container *ngFor="let column of columns | filter: filterRule">\n    <nz-tab [nzTitle]="titleTemplate">\n      <ng-template #titleTemplate>\n        <div class="flex">\n          <span class="label">{{ column.title + \'：\' }}</span>\n          <ng-container\n            *ngIf="(column.searchValue | translate: column.lexicon || lexicon)?.length > 10; else textTemplate"\n          >\n            <div nz-popover nzTrigger="hover" [nzContent]="textTemplate" nzPlacement="bottom">\n              <span class="value text-ellipsis">\n                {{ column.displayValue || column.searchValue | translate: column.lexicon || lexicon }}\n              </span>\n            </div>\n          </ng-container>\n\n          <ng-template #textTemplate>\n            <div>\n              <span class="value">\n                {{ column.displayValue || column.searchValue | translate: column.lexicon || lexicon }}\n              </span>\n            </div>\n          </ng-template>\n\n          <div>\n            <i nz-icon type="close" class="ant-tabs-close-x" (click)="closeTab(column)"></i>\n          </div>\n        </div>\n      </ng-template>\n    </nz-tab>\n  </ng-container>\n</nz-tabset>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".text-ellipsis{display:inline-block;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;vertical-align:top}.flex{display:flex;justify-content:center;align-items:center}.label{color:#515151}.value{color:#1890ff}:host ::ng-deep .ant-tabs.ant-tabs-card .ant-tabs-bar{border:none;margin:0 0 2px}:host ::ng-deep .ant-tabs.ant-tabs-card .ant-tabs-bar .ant-tabs-tab{margin:0 2px 0 0;border:1px solid #e8e8e8!important;border-radius:4px;background:#fafafa;padding:0 16px;transition:.3s cubic-bezier(.645,.045,.355,1);line-height:28px;height:30px}:host ::ng-deep .ant-tabs.ant-tabs-card .ant-tabs-bar .ant-tabs-nav-container{height:31px}:host ::ng-deep .ant-tabs.ant-tabs-card .ant-tabs-bar .ant-tabs-tab-active{font-weight:400}"]}]}],n.ctorParameters=function(){return[]},n.propDecorators={columns:[{type:t.Input}],lexicon:[{type:t.Input}],columnsChange:[{type:t.Output}],queryChange:[{type:t.Output}],close:[{type:t.Output}],filterRule:[{type:t.Input}]},n}(),y=function(){function n(){}return n.decorators=[{type:t.NgModule,args:[{declarations:[f],imports:[e.CommonModule,s.TranslatePipeModule,s.FilterPipeModule,i.NgZorroAntdModule],exports:[f]}]}],n}(),x=function(){function n(){this.text="",this.maxLength=20,this.tail="..."}return n.decorators=[{type:t.Component,args:[{selector:"smart-text",template:'\x3c!-- 直接显示 --\x3e\n<ng-container *ngIf="text.length <= maxLength; else tooltipBlock">\n  <span>{{ text }}</span>\n</ng-container>\n\n\x3c!-- 提示框显示 --\x3e\n<ng-template #tooltipBlock>\n  <span nz-tooltip [nzTitle]="text">{{ text | shortcut: maxLength:tail }}</span>\n</ng-template>\n\n<ng-content></ng-content>\n'}]}],n.propDecorators={text:[{type:t.Input}],maxLength:[{type:t.Input}],tail:[{type:t.Input}]},n}(),z=function(){function n(){}return n.decorators=[{type:t.NgModule,args:[{imports:[e.CommonModule,s.ShortcutPipeModule,c.NzToolTipModule],declarations:[x],exports:[e.CommonModule,x]}]}],n}(),C=[m,h,d],b=[e.CommonModule,o.FormsModule,i.NgZorroAntdModule,y,z,a.ViewerDirectiveModule,y],w=function(){function n(){}return n.decorators=[{type:t.NgModule,args:[{declarations:g(C),imports:g(b),exports:g(b,C)}]}],n}();n.AdvancedTableModule=w,n.ɵa=m,n.ɵb=h,n.ɵc=d,n.ɵd=y,n.ɵe=f,n.ɵf=z,n.ɵg=x,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=pixelmon-pikachu-advanced-table.umd.min.js.map