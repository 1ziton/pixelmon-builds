/**
 * @license ng-alain(cipchk@qq.com) v0.1.4
 * (c) 2019 giscafer(giscafer@outlook.com)
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("@angular/forms"),require("@pixelmon/util"),require("ng-zorro-antd")):"function"==typeof define&&define.amd?define("@pixelmon/pikachu/advanced-upload",["exports","@angular/core","@angular/common","rxjs","@angular/forms","@pixelmon/util","ng-zorro-antd"],t):t(((e=e||self).pixelmon=e.pixelmon||{},e.pixelmon.pikachu=e.pixelmon.pikachu||{},e.pixelmon.pikachu["advanced-upload"]={}),e.ng.core,e.ng.common,e.rxjs,e.ng.forms,e.util,e.ngZorroAntd)}(this,function(e,t,n,o,i,r,s){"use strict";var a=function(){return(a=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var p=function(){};var l=function(){function e(e,t){var n=this;this._cdr=e,this._uploadSrv=t,this.accept="image/png,image/jpeg,image/gif,image/bmp",this.action="",this.directory=!1,this.disabled=!1,this.limit=9,this.size=0,this.fileType="image/png,image/jpeg,image/gif,image/bmp",this.listType="picture-card",this.multiple=!0,this.showButton=!0,this.placeholder="上传",this.maxLength=1/0,this.bucket="bucket",this.fastUpload=!0,this.filter=[{name:"maxLength",fn:function(e){return e.slice(0,n.maxLength-n.fileList.length)}}],this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.bosClient=null,this.isSupportWorker=!1,this.isLoading=!1,this.fileList=[],this.previewModal={visible:!1,image:""},this.preview=function(e){n.previewModal.image=e.url||e.thumbUrl,n.previewModal.visible=!0,n._cdr.detectChanges()},this.customRequest=function(e){var t=e.file;return n.getUploadKey(t).then(function(o){n.isSupportWorker&&n.fastUpload?n.bosClient.getObjectMetadata(n.bucket,o).then(function(i){t.url=n.bosClient.config.endpoint+"/v1/"+n.bucket+"/"+o,e.onSuccess("上传成功",t,i)}).catch(function(){return n.bosUpload(e,n.bucket,o,t)}):n.bosUpload(e,n.bucket,o,t)}),new o.Subscription},this.initBosClient()}return Object.defineProperty(e.prototype,"showPreviewIcon",{set:function(e){this.showUploadList=a({},this.showUploadList,{showPreviewIcon:e})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showRemoveIcon",{set:function(e){this.showUploadList=a({},this.showUploadList,{showPreviewIcon:e})},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){"undefined"!=typeof Worker?this.isSupportWorker=!0:this.fastUpload&&console.error("浏览器不支持Worker，无法使用快传！")},e.prototype.writeValue=function(e){this.fileList=e||[],this.fileList.forEach(function(e){e.uid=e.uid||r.uid()}),this._cdr.detectChanges()},e.prototype.registerOnChange=function(e){this.fileListChange=e},e.prototype.registerOnTouched=function(){},e.prototype.initBosClient=function(){var e=this;this._uploadSrv.getConfig()&&(this.isLoading=!0,this._uploadSrv.getConfig().subscribe(function(t){e.bosClient=new baidubce.sdk.BosClient({endpoint:t.endpoint,credentials:{ak:t.ak,sk:t.sk},sessionToken:t.sessionToken}),e.isLoading=!1,e._cdr.detectChanges()}))},e.prototype.getUploadKey=function(e){var t=this;return new Promise(function(n){if(t.isSupportWorker&&t.fastUpload){var o=new Worker(t._uploadSrv.workerUrl);o.onerror=function(e){console.error("Worker异常，已关闭！",e),o.terminate()},o.postMessage(e),o.onmessage=function(t){var i=""+t.data+e.lastModified+e.size+e.name;n(i),o.terminate()}}else{var i=""+(""+(new Date).getTime()+(1e4*Math.random()).toFixed(0))+e.lastModified+e.size+e.name;n(i)}})},e.prototype.bosUpload=function(e,t,n,o){var i=this;this.bosClient.putObjectFromBlob(t,n,o).then(function(r){o.url=i.bosClient.config.endpoint+"/v1/"+t+"/"+n,e.onSuccess("上传成功",o,r)}).catch(function(t){e.onError(t,o)})},e.prototype.onFileListChange=function(){this.fileListChange(this.fileList.map(function(e){return a({},e,{thumbUrl:""})})),this._cdr.detectChanges()},e.prototype.onChange=function(){this.fileList.forEach(function(e){e.url=e.url||e.originFileObj&&e.originFileObj.url}),this.onFileListChange()},e.decorators=[{type:t.Component,args:[{selector:"p-advancedUpload",template:'<nz-upload\n  [nzAction]="action"\n  [nzAccept]="accept"\n  [nzListType]="listType"\n  [(nzFileList)]="fileList"\n  [nzShowButton]="showButton && fileList.length < maxLength"\n  [nzFileType]="fileType"\n  [nzShowUploadList]="showUploadList"\n  [nzDirectory]="directory"\n  [nzLimit]="limit"\n  [nzSize]="size"\n  [nzDisabled]="disabled || isLoading"\n  [nzMultiple]="multiple"\n  [nzPreview]="preview"\n  [nzRemove]="remove"\n  [nzFilter]="filter"\n  [nzBeforeUpload]="beforeUpload"\n  [nzCustomRequest]="customRequest"\n  (nzFileListChange)="onFileListChange()"\n  (nzChange)="onChange()"\n>\n  \x3c!-- 自定义content --\x3e\n  <ng-template [ngIf]="customContent" [ngIfElse]="defaultContent">\n    <ng-container [ngTemplateOutlet]="customContent"></ng-container>\n  </ng-template>\n\n  \x3c!-- 默认content --\x3e\n  <ng-template #defaultContent>\n    <ng-container [ngSwitch]="listType">\n      <ng-container *ngSwitchCase="\'picture-card\'">\n        <i nz-icon nzType="plus" class="upload-icon"></i>\n        <div class="upload-text">{{ placeholder }}</div>\n      </ng-container>\n      <ng-container *ngSwitchDefault>\n        <button nz-button>\n          <i nz-icon nzType="upload"></i>\n          <span>{{ placeholder }}</span>\n        </button>\n      </ng-container>\n    </ng-container>\n  </ng-template>\n</nz-upload>\n\n\x3c!-- 预览弹框 --\x3e\n<nz-modal [(nzVisible)]="previewModal.visible" [nzFooter]="null" (nzOnCancel)="previewModal.visible = false">\n  <img [src]="previewModal.image" width="100%" />\n</nz-modal>\n',providers:[{provide:i.NG_VALUE_ACCESSOR,useExisting:e,multi:!0}],changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".upload-icon{color:#999;font-size:32px}.upload-text{margin-top:8px;color:#666}"]}]}],e.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:p}]},e.propDecorators={accept:[{type:t.Input}],action:[{type:t.Input}],directory:[{type:t.Input}],disabled:[{type:t.Input}],limit:[{type:t.Input}],size:[{type:t.Input}],fileType:[{type:t.Input}],listType:[{type:t.Input}],multiple:[{type:t.Input}],showButton:[{type:t.Input}],placeholder:[{type:t.Input}],customContent:[{type:t.Input}],maxLength:[{type:t.Input}],bucket:[{type:t.Input}],fastUpload:[{type:t.Input}],filter:[{type:t.Input}],showPreviewIcon:[{type:t.Input}],showRemoveIcon:[{type:t.Input}],beforeUpload:[{type:t.Input}],remove:[{type:t.Input}],preview:[{type:t.Input}],customRequest:[{type:t.Input}]},e}();var u=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[l],imports:[n.CommonModule,s.NgZorroAntdModule],exports:[n.CommonModule,s.NgZorroAntdModule,l]}]}],e}();e.AdvancedUploadModule=u,e.ɵa=p,e.ɵb=l,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pixelmon-pikachu-advanced-upload.umd.min.js.map