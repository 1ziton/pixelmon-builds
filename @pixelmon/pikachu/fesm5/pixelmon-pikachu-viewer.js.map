{"version":3,"file":"pixelmon-pikachu-viewer.js","sources":["ng://@pixelmon/pikachu/viewer/viewer.directive.ts"],"sourcesContent":["/**\n * @Description: åºäºviewerå°è£\n * @Author: zomixi\n * @Date: 2019-07-09 16:56:59\n */\n\nimport { NgModule, Directive, AfterContentInit, OnDestroy, ContentChildren, QueryList, ElementRef, Input, OnInit } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\ndeclare var Viewer;\n\n@Directive({\n  selector: '[viewerImg]',\n})\nexport class ViewerImgDirective implements OnInit {\n  @Input() lazyLoadSrc = ''; // æå è½½å¾çurl\n  @Input() thumbnailSrc = '/assets/img/thumbnail.png'; // æå è½½ç¼©ç¥å¾url\n  nativeElement: HTMLImageElement; // HTMLImageElementå®ä¾\n\n  constructor(private _elementRef: ElementRef<HTMLImageElement>) {\n    this.nativeElement = this._elementRef.nativeElement;\n  }\n\n  ngOnInit() {\n    // æå è½½æ¶èµå¼url\n    if (this.lazyLoadSrc) {\n      this.nativeElement.src = this.thumbnailSrc;\n      this.nativeElement.dataset.lazyLoadSrc = this.lazyLoadSrc;\n    }\n  }\n}\n\n@Directive({\n  selector: '[viewer]',\n})\nexport class ViewerDirective implements AfterContentInit, OnDestroy {\n  viewer: any = null; // viewerå®ä¾\n  private _subscription: Subscription; // ç¨äºunsubscribe\n\n  @Input() isLazyLoad = false; // æ¯å¦æå è½½å¾ç\n  @Input() maxShowNum = Infinity; // æå¤§æ¾ç¤ºæ°é\n  @ContentChildren(ViewerImgDirective, { descendants: true }) viewerImgs: QueryList<ViewerImgDirective>; // å½viewerImgsæ¹åæ¶èªå¨æ´æ°viewer\n\n  constructor(private _elementRef: ElementRef) {}\n\n  ngAfterContentInit() {\n    this.initViewer();\n\n    this._subscription = this.viewerImgs.changes.subscribe(() => {\n      // ç­å¾DOMæ´æ°\n      setTimeout(() => {\n        this.initViewer();\n      });\n    });\n  }\n\n  ngOnDestroy() {\n    if (this._subscription) {\n      this._subscription.unsubscribe();\n    }\n  }\n\n  initViewer() {\n    let imgElements: HTMLCollection;\n    // å ä¸ºreadyäºä»¶åªä¼æ§è¡ä¸éï¼æéç¨destroyånewçæ¹æ³ï¼updateæ¹æ³ä¸éç¨\n    if (this.viewer) {\n      this.viewer.destroy();\n    }\n    this.viewer = new Viewer(this._elementRef.nativeElement, {\n      ready: () => {\n        imgElements = this.viewer.images || [];\n\n        // ç»srcèµå¼æå è½½url\n        if (this.isLazyLoad) {\n          // tslint:disable-next-line: prefer-for-of\n          for (let index = 0; index < imgElements.length; index++) {\n            const element = imgElements[index] as HTMLImageElement;\n            element.src = element.dataset.lazyLoadSrc as string;\n          }\n        }\n      },\n    });\n\n    // vieweråå§ååææviewer.images\n    imgElements = this.viewer.images || [];\n\n    // è¶è¿æå¤§æ°éçä¸æ¾ç¤º\n    for (let index = this.maxShowNum; index < imgElements.length; index++) {\n      const element = imgElements[index] as HTMLImageElement;\n      element.hidden = true;\n    }\n  }\n}\n\n@NgModule({\n  declarations: [ViewerDirective, ViewerImgDirective],\n  exports: [ViewerDirective, ViewerImgDirective],\n})\nexport class ViewerDirectiveModule {}\n"],"names":[],"mappings":"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"}